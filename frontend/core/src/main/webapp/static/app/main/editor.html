<div id="editor-drawer" class="container-editor" ng-controller="EditorController" data-snap-ignore="true">
  <div ng-if="editorVisible">

    <header class="container-titlebar">
      <div class="group-navigation">
        <a href class="link-navigation-back" ng-class="!isFirstSlide() && 'not-swipeable'" ng-click="endEdit()" ng-bind="saveOnClose ? 'save' : 'back'"></a>
      </div>

      <form role="form" class="group-mixed" ng-submit="saveItemInEdit()" autocapitalize="none" autocorrect="off">
        <div class="group-mixed--left">
          <input ng-if="itemHasActionButton" type="checkbox" ng-model="task.completed" icon-checkbox="editorTitlebarCheckbox" />
        </div>
        <div class="group-mixed--middle">
          <textarea type="text" ng-model="titlebar.text" ng-keydown="titlebarTextKeyDown($event)" editor-titlebar-text-input msd-elastic dynamic-placeholder="{{getTitlebarTextInputPlaceholder()}}" maxlength="128" required ></textarea>
        </div>
        <div class="group-mixed--right">
          <button ng-show="titlebarHasText()" type="button" class="btn-clear" ng-click="clearTitlebarText()"></button>
        </div>
      </form>

      <div ng-if="editorType === 'item'" class="group-btn row">
        <button type="button" class="btn-tab" ng-disabled="isItemEditorTabActive('inbox')" ng-click="setItemEditorTabActive('inbox')">
          <span class="text-btn">inbox</span>
        </button>
        <button type="button" class="btn-tab" ng-disabled="isItemEditorTabActive('task')" ng-click="setItemEditorTabActive('task')">
          <span class="text-btn">task</span>
        </button>
        <button type="button" class="btn-tab" ng-disabled="isItemEditorTabActive('note')" ng-click="setItemEditorTabActive('note')">
          <span class="text-btn">note</span>
        </button>
        <button type="button" class="btn-tab" ng-disabled="isItemEditorTabActive('list')" ng-click="setItemEditorTabActive('list')">
          <span class="text-btn">list</span>
        </button>
      </div>
    </header>

    <div ng-switch="editorType" class="omnibar-feature" ng-style="{height: getEditorHeight()}" scroll-to>

      <div ng-switch-when="omnibar" class="omnibar-search">

        <button ng-if="keywords.length" type="button" class="font-small button" ng-class="omnibarKeywords.visible ? 'selected-keyword' : 'keyword'" ng-click="toggleOmnibarKeywordsVisible()">
          keywords <strong ng-bind="omnibarKeywords.visible ? 'x' : '+'"></strong>
        </button>

        <div ng-if="omnibarKeywords.visible" class="keywords-container">
          <button ng-init="keywordSelected = false" ng-repeat="keyword in getSelectedAndFilterUnselectedKeywords()" type="button" class="button font-small keyword" ng-class="keywordSelected ? 'selected-keyword' : 'keyword'" ng-click="keywordSelected = !keywordSelected; toggleKeywordSelected(keyword);">
            {{keyword.title}} <strong ng-bind="keywordSelected ? 'x' : '+'"></strong>
          </button>
        </div>

        <div ng-if="omnibarKeywords.visible && !isLoading">
          <div ng-show="filteredNotes.length" class="filtered-items">
            <h3><a href ng-click="gotoNotes()">notes</a></h3>
            <div class="inner-page-content-container" accordion>
              <div ng-repeat="note in filteredNotes = getFilteredOmnibarNotes()">
                <div accordion-title="note" edit-item="editNote(note)" edit-item-fields="editNoteFields(note)" has-complete="false" toggle-complete></div>
                <div ng-if="isOpen(note)" editable-field-container="auto">
                  <div ng-include="'static/app/notes/noteActions.html'"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div ng-if="!isSearchActive() && !omnibarKeywords.visible" class="omnibar-empty-search-placeholder" ng-style="{maxHeight: getSearchPlaceholderMaxHeight()}" ng-click="hideEmptyOmnibar()"></div>

        <div ng-if="isSearchActive() && !omnibarKeywords.visible && !isLoading">
          <div ng-show="filteredItems.length" class="filtered-items">
            <h3 ><a href ng-click="gotoInbox()">inbox</a></h3>
            <div class="inner-page-content-container" accordion>
              <div ng-repeat="item in filteredItems = (items | filter:{title:searchText.delayed} | limitTo:10)">
                <div accordion-title="item" edit-item="editItem(item)" edit-item-inline="true" edit-item-fields="editItemFields(item)" toggle-complete="false"></div>
                <div ng-if="isOpen(item)" editable-field-container="auto">
                  <div item-core-fields="item" item-core-fields-details="itemDetails"></div>
                  <div ng-include="'static/app/main/itemActions.html'"></div>
                </div>
              </div>
            </div>
          </div>

          <div ng-show="filteredTasks.length" class="filtered-items">
            <h3><a href ng-click="gotoTasks()">tasks</a></h3>
            <div class="inner-page-content-container" accordion>
              <div ng-repeat="task in filteredTasks = (allActiveTasks | filter:{title:searchText.delayed} | limitTo:10)">
                <div accordion-title="task" edit-item="editTask(task)" edit-item-fields="editTaskFields(task)" has-complete="true" toggle-complete="taskChecked(task)"></div>
                <div ng-if="isOpen(task)" editable-field-container="auto">
                  <div item-core-fields="task" item-core-fields-details="itemDetails"></div>
                  <div ng-init="initializeTask(task)" ng-include="'static/app/tasks/taskActions.html'"></div>
                </div>
              </div>
            </div>
          </div>

          <div ng-show="filteredNotes.length" class="filtered-items">
            <h3><a href ng-click="gotoNotes()">notes</a></h3>
            <div class="inner-page-content-container" accordion>
              <div ng-repeat="note in filteredNotes = (allNotes | filter:{title:searchText.delayed} | limitTo:10)">
                <div accordion-title="note" edit-item="editNote(note)" edit-item-fields="editNoteFields(note)" has-complete="false" toggle-complete></div>
                <div ng-if="isOpen(note)" editable-field-container="auto">
                  <div ng-include="'static/app/notes/noteActions.html'"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div ng-switch-when="task" class="omnibar-task omnibar-edit-item-scroller-wrapper" omnibar-edit-item-scroller="setActiveSlideIndex(slideIndex)" omnibar-edit-item-scroller-goto-slide-fn="registerGotoEditItemScrollerSlideFn(gotoSlideFn)" omnibar-edit-item-scroller-has-indicators-fn="setEditItemHasScrollerIndicators(hasIndicators)">
        <div class="omnibar-edit-item-scroller">
          <form role="form">

            <div class="omnibar-scroller-slide" editable-field-container>
              <div ng-hide="snoozeOpen || calendarOpen">
                <span ng-if="hideTaskProperties()" class="show-more">more</span>
                <div ng-hide="hideTaskProperties()">
                  <span ng-click="openCalendar()" ng-bind="task.transientProperties.date ? (task.transientProperties.date | date:'EEE MMM d y' | lowercase) : 'select date'"></span>
                  <div ng-include="'static/app/tasks/taskCoreFields.html'"></div>
                </div>
                <div class="form-group omnibar-scroll-container" ng-style="{maxHeight: getEditTaskDescriptionMaxHeight()}" >
                  <textarea id="taskDescription" class="simple-input" ng-model="task.transientProperties.description" ng-focus="taskDescriptionFocus()" ng-blur="taskDescriptionBlur()" msd-elastic editable-field placeholder="description..." maxlength="1024"></textarea>
                </div>
              </div>
              <div ng-if="snoozeOpen && !calendarOpen" snooze="{{task.transientProperties.date}}" snooze-close-and-save="closeSnoozeAndSave(date)" snooze-close-and-open="closeSnoozeAndOpenCalendar()" snooze-destroy="closeSnooze()"></div>
              <div ng-if="calendarOpen" class="pikaday-embedded" calendar="{{task.transientProperties.date}}" calendar-get-date-fn="registerGetCalendarDateFn(getCalendarDateFn)" calendar-set-default-date="true" calendar-destroy="closeCalendar()" bound="false"></div>

              <footer>
                <div class="group-btn">
                  <button type="button" class="btn-delete">
                    <span class="text-btn">delete</span>
                  </button>
                  <button ng-if="!calendarOpen" type="button" class="btn-checkbox" ng-click="toggleSnooze()">
                    <span class="text-btn" ng-bind="task.transientProperties.date ? 'snooze' : 'set date'"></span>
                  </button>
                  <button ng-if="calendarOpen" type="button" class="wide-button normal-button" ng-click="closeCalendarAndSave(calendarCloseCallbackFn)">
                    <span>done</span>
                  </button>
                </div>
              </footer>

            </div>

            <div class="omnibar-scroller-slide" editable-field-container>
              <div ng-if="task.transientProperties.date" class="form-group">
                <select id="taskRepeat" class="simple-input" ng-model="task.repeating" ng-options="repeatType as repeatType for repeatType in repeatTypes" editable-field>
                  <option value="">select repeating...</option>
                </select>
              </div>
              <div class="form-group">
                <input type="text" id="taskLink" class="simple-input" ng-model="task.link" editable-field placeholder="url...">
              </div>
            </div>

          </form>
        </div>
      </div>

      <div ng-switch-when="note" class="omnibar-note omnibar-edit-item-scroller-wrapper"  omnibar-edit-item-scroller="setActiveSlideIndex(slideIndex)" omnibar-edit-item-scroller-goto-slide-fn="registerGotoEditItemScrollerSlideFn(gotoSlideFn)" omnibar-edit-item-scroller-has-indicators-fn="setEditItemHasScrollerIndicators(hasIndicators)">
        <div class="omnibar-edit-item-scroller">
          <form role="form">

            <div class="omnibar-scroller-slide" editable-field-container ng-style="{maxHeight: getEditNoteContentMaxHeight()}">
              <div class="form-group omnibar-scroll-container">
                <textarea id="noteContent" class="simple-input" ng-model="note.content" msd-elastic editable-field placeholder="content..."></textarea>
              </div>
            </div>

            <div class="omnibar-scroller-slide" editable-field-container>
              <div class="form-group">
                <input type="text" id="noteKeywords" class="simple-input" ng-model="newKeyword.title" editable-field placeholder="keywords..." maxlength="128" autocapitalize="none"/>
              </div>
              <div class="keywords-container">
                <span ng-if="showKeywords()" id="new-keyword">
                  <button type="button" class="font-small button keyword" ng-disabled="isSelectedKeyword()" ng-click="selectNewKeyword()">
                    {{newKeyword.title}} <strong>+</strong>
                  </button>
                </span>

                <span ng-if="noteHasKeywords()">
                  <button ng-repeat="keyword in keywords | keywordsFilter:{name: 'byNoteUUID', item:note}" type="button" class="button font-small selected-keyword" ng-click="unSelectKeyword(keyword)">{{keyword.title}} <strong>x</strong></button>
                </span>
              </div>

              <div ng-if="showKeywords()" class="keywords-container">
                <button ng-hide="isNewKeyword(keyword)" ng-repeat="keyword in keywords | keywordsFilter:{name: 'byOtherThanNoteUUID', item: note} | filter: {title: newKeyword.title}" type="button" class="button font-small keyword" ng-click="selectExistingKeyword(keyword)">
                  {{keyword.title}} <strong>+</strong>
                </button>
              </div>

              <div lists-select-options>
                <div ng-if="!addNewListVisible" class="form-group select-list-visible-animation">
                  <select id="noteList" class="simple-input swiper-no-swiping" ng-model="note.transientProperties.list" ng-options="list.uuid as list.title for list in listsSelectOptions" options-disabled="list.delimiter for list in listsSelectOptions" editable-field>
                    <option value="">select list...</option>
                  </select>
                </div>

                <div ng-if="addNewListVisible" class="form-group select-list-visible-animation">
                  <div class="left-input-wrapper">
                    <input type="text" class="simple-input" ng-model="newList.title" placeholder="add list..."/>
                  </div>
                  <div class="right-button-wrapper item-actions">
                    <a href class="font-smallest add-new-list-item-cancel" ng-click="setAddNewListHidden()">cancel</a>
                  </div>
                </div>
              </div>
            </div>

          </form>
        </div>
      </div>
    </div>

  </div>
</div>
