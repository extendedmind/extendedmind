<div class="omnibar-container swiper-no-swiping" data-snap-ignore="true">

  <form role="form" name="addOmniItem" ng-submit="saveOmnibarText()" autocapitalize="none" autocorrect="off">
    <div class="form-group">
      <div ng-class="{'left-input-wrapper' : omnibarHasText() && !isItemEditMode && !isItemAddMode}">
        <textarea type="text" class="simple-input omnibar-input" ng-class="getOmnibarClass()" ng-model="omnibarText.title" ng-keydown="omnibarKeyDown($event)" omnibar-input msd-elastic dynamic-placeholder="{{getOmnibarInputPlaceholder()}}" maxlength="128" required ></textarea>
      </div>
      <div ng-show="omnibarHasText() && !isItemEditMode && !isItemAddMode" class="right-button-wrapper">
        <button type="button" class="button omnibar-x-icon" ng-click="clearOmnibar()"><span class="icon-x"></span>
        </button>
      </div>
    </div>
  </form>

  <div ng-if="!isItemEditMode && !isItemAddMode">
    <ul class="button-row">
      <li class="button-container left-of-three">
        <button type="button" class="tab-button search-tab-button" ng-disabled="isOmnibarFeatureActive('search')" ng-click="setOmnibarFeatureActive('search')">
          <span>search</span>
        </button>
      </li>
      <li class="button-container center-of-three">
        <button type="button" class="tab-button" ng-disabled="isOmnibarFeatureActive('task')" ng-click="setOmnibarFeatureActive('task')">
          <span>task</span>
        </button>
      </li>
      <li class="button-container right-of-three">
        <button type="button" class="tab-button" ng-disabled="isOmnibarFeatureActive('note')" ng-click="setOmnibarFeatureActive('note')">
          <span>note</span>
        </button>
      </li>
    </ul>

  </div>

  <div ng-switch="getActiveOmnibarFeature()" class="omnibar-feature" ng-style="{height: getOmnibarFeatureHeight()}" scroll-to>

    <div ng-switch-when="search" class="omnibar-search">

      <button ng-if="keywords.length" type="button" class="font-small button" ng-class="omnibarKeywords.isVisible ? 'selected-keyword' : 'keyword'" ng-click="toggleOmnibarKeywordsVisible()">
        keywords <strong ng-bind="omnibarKeywords.isVisible ? 'x' : '+'"></strong>
      </button>

      <div ng-if="omnibarKeywords.isVisible" class="keywords-container">
        <button ng-init="isKeywordSelected = false" ng-repeat="keyword in getSelectedAndFilterUnselectedKeywords()" type="button" class="button font-small keyword" ng-class="isKeywordSelected ? 'selected-keyword' : 'keyword'" ng-click="isKeywordSelected = !isKeywordSelected; toggleKeywordSelected(keyword);">
          {{keyword.title}} <strong ng-bind="isKeywordSelected ? 'x' : '+'"></strong>
        </button>
      </div>

      <div ng-if="omnibarKeywords.isVisible && !isLoading">
        <div ng-show="filteredNotes.length" class="filtered-items">
          <h3><a href ng-click="gotoNotes()">notes</a></h3>
          <div class="inner-page-content-container" accordion>
            <div ng-repeat="note in filteredNotes = getFilteredOmnibarNotes()">
              <div accordion-title="note" edit-item="editNote(note)" edit-item-fields="editNoteFields(note)" has-complete="false" toggle-complete></div>
              <div ng-if="isOpen(note)" editable-field-container="auto">
                <div ng-include="'static/app/notes/noteActions.html'"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div ng-if="!isSearchActive() && !omnibarKeywords.isVisible" class="omnibar-empty-search-placeholder" ng-style="{maxHeight: getSearchPlaceholderMaxHeight()}" ng-click="hideEmptyOmnibar()"></div>

      <div ng-if="isSearchActive() && !omnibarKeywords.isVisible && !isLoading">
        <div ng-show="filteredItems.length" class="filtered-items">
          <h3 ><a href ng-click="gotoInbox()">inbox</a></h3>
          <div class="inner-page-content-container" accordion>
            <div ng-repeat="item in filteredItems = (items | filter:{title:searchText.delayed} | limitTo:10)">
              <div accordion-title="item" edit-item="editItem(item)" edit-item-inline="true" edit-item-fields="editItemFields(item)" toggle-complete="false"></div>
              <div ng-if="isOpen(item)" editable-field-container="auto">
                <div item-core-fields="item" item-core-fields-details="itemDetails"></div>
                <div ng-include="'static/app/main/itemActions.html'"></div>
              </div>
            </div>
          </div>
        </div>

        <div ng-show="filteredTasks.length" class="filtered-items">
          <h3><a href ng-click="gotoTasks()">tasks</a></h3>
          <div class="inner-page-content-container" accordion>
            <div ng-repeat="task in filteredTasks = (allActiveTasks | filter:{title:searchText.delayed} | limitTo:10)">
              <div accordion-title="task" edit-item="editTask(task)" edit-item-fields="editTaskFields(task)" has-complete="true" toggle-complete="taskChecked(task)"></div>
              <div ng-if="isOpen(task)" editable-field-container="auto">
                <div item-core-fields="task" item-core-fields-details="itemDetails"></div>
                <div ng-init="initializeTask(task)" ng-include="'static/app/tasks/taskActions.html'"></div>
              </div>
            </div>
          </div>
        </div>

        <div ng-show="filteredNotes.length" class="filtered-items">
          <h3><a href ng-click="gotoNotes()">notes</a></h3>
          <div class="inner-page-content-container" accordion>
            <div ng-repeat="note in filteredNotes = (allNotes | filter:{title:searchText.delayed} | limitTo:10)">
              <div accordion-title="note" edit-item="editNote(note)" edit-item-fields="editNoteFields(note)" has-complete="false" toggle-complete></div>
              <div ng-if="isOpen(note)" editable-field-container="auto">
                <div ng-include="'static/app/notes/noteActions.html'"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div ng-switch-when="task" class="omnibar-task">
      <span ng-if="hideTaskProperties()" class="show-more">more</span>

      <form role="form" editable-field-container>
        <div ng-hide="hideTaskProperties()">
          <div class="form-group">
            <div ng-if="showDateInput">
              <label for="taskDue" class="sr-only">select date...</label>
              <input type="date" id="taskDue" class="simple-input" date-input-blur="hideDate" ng-model="task.date" date-input="task" date-input-set-focus="focusDateInput">
            </div>
            <div ng-if="!showDateInput" class="item-actions">
              <span class="simple-input default-element date-input-placeholder" ng-click="focusDate()">select date...</span>
            </div>
          </div>
          <div ng-include="'static/app/tasks/taskCoreFields.html'"></div>
          <div ng-if="task.date" class="form-group">
            <label for="taskRepeat" class="sr-only">repeating</label>
            <select id="taskRepeat" class="simple-input" ng-model="task.repeating" ng-options="repeatType as repeatType for repeatType in repeatTypes" editable-field>
              <option value="">select repeating...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="taskLink" class="sr-only">url</label>
            <input type="text" id="taskLink" class="simple-input" ng-model="task.link" editable-field placeholder="url...">
          </div>
        </div>
        <div class="form-group omnibar-scroll-container" ng-style="{maxHeight: getEditTaskDescriptionMaxHeight()}" >
          <label for="taskDescription" class="sr-only">description</label>
          <textarea id="taskDescription" class="simple-input" ng-model="task.description" ng-focus="taskDescriptionFocus()" ng-blur="taskDescriptionBlur()" msd-elastic editable-field placeholder="description..." maxlength="1024"></textarea>
        </div>
      </form>
    </div>

    <div ng-switch-when="note" class="omnibar-note">

      <span ng-if="hideNoteProperties()" class="show-more">more</span>

      <form role="form" editable-field-container>

        <div ng-hide="hideNoteProperties()">
          <div class="form-group">
            <label for="noteKeywords" class="sr-only">keywords</label>
            <input type="text" id="noteKeywords" class="simple-input" ng-model="newKeyword.title" editable-field placeholder="keywords..." maxlength="128" autocapitalize="none"/>
          </div>
          <div class="keywords-container">
            <span ng-if="showKeywords()" id="new-keyword">
              <button type="button" class="font-small button keyword" ng-disabled="isSelectedKeyword()" ng-click="selectNewKeyword()">
                {{newKeyword.title}} <strong>+</strong>
              </button>
            </span>

            <span ng-if="noteHasKeywords()">
              <button ng-repeat="keyword in noteKeywords()" type="button" class="button font-small selected-keyword" ng-click="unSelectKeyword(keyword)">{{keyword.title}} <strong>x</strong></button>
            </span>
          </div>

          <div ng-if="showKeywords()" class="keywords-container">
            <button ng-hide="isNewKeyword(keyword)" ng-repeat="keyword in otherThanNoteKeywords() | filter: {title: newKeyword.title}" type="button" class="button font-small keyword" ng-click="selectExistingKeyword(keyword)">
              {{keyword.title}} <strong>+</strong>
            </button>
          </div>

          <div lists-select-options>
            <div ng-if="!addNewListVisible" class="form-group select-list-visible-animation">
              <label for="noteList" class="sr-only">list</label>
              <select id="noteList" class="simple-input swiper-no-swiping" ng-model="note.relationships.list" ng-options="list.uuid as list.title for list in listsSelectOptions" options-disabled="list.delimiter for list in listsSelectOptions" editable-field>
                <option value="">select list...</option>
              </select>
            </div>

            <div ng-if="addNewListVisible" class="form-group select-list-visible-animation">
              <div class="left-input-wrapper">
                <input type="text" class="simple-input" ng-model="newList.title" placeholder="add list..."/>
              </div>
              <div class="right-button-wrapper item-actions">
                <a href class="font-smallest add-new-list-item-cancel" ng-click="setAddNewListHidden()">cancel</a>
              </div>
            </div>
          </div>
        </div>
        <div ng-if="!showKeywords()" class="form-group omnibar-scroll-container" ng-style="{maxHeight: getEditNoteContentMaxHeight()}">
          <label for="noteContent" class="sr-only">content</label>
          <textarea id="noteContent" class="simple-input" ng-model="note.content" ng-focus="noteContentFocus()" ng-blur="noteContentBlur()" msd-elastic editable-field placeholder="content..."></textarea>
        </div>
      </form>
    </div>
  </div>

  <div class="omnibar-footer font-small">
    <button type="button" class="button transparent-button omnibar-footer-button-left" ng-click="cancelOmnibarEdit()">cancel</button>
    <button type="submit" class="button transparent-button omnibar-footer-button-right" ng-click="saveOmnibarText()" ng-disabled="!addOmniItem.$valid || isLoading" ng-bind="getOmnibarFooterSaveText()"></button>
  </div>

</div>
